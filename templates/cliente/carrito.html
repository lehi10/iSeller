    {% extends 'base/base.html' %}

{% load staticfiles %}
{% block title %}
iSeller - Perfil
{% endblock %}


{% block content %}




<div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1>Carrito de Compras </h1>
            </div>
            <div class="col-md-6">
                <ul class="breadcrumb">
                    <li><a href="index.html">Home</a>
                    </li>
                    <li>Shopping cart</li>
                </ul>

            </div>
        </div>
    </div>
</div>

<div id="content">
    <div class="container">

        <div class="row">
            {% block estadoCarrito %}
                {%if estadoCarrito %}
                    <div class="alert alert-success alert-dismissable fade in">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            <strong>Agregado!</strong> {{ detalles.0.nombre }} fue agregado a su Carrito de Compras.
                    </div>
                {%endif%}
                
            {% endblock %}
            <div class="col-md-12">
                <p class="text-muted lead">Productos en tu carrito de compras : </p>
            </div>


            <div class="col-md-9 clearfix" id="basket">

                <div class="box">

                    <form method="post" action="shop-checkout1.html">

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th colspan="2">Producto</th>
                                        <th>Cantidad</th>
                                        <th>Precio por unidad</th>
                                        <th>Descuento</th>
                                        <th colspan="2">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <!-- ITEM  -->
                                
                                {% for item in listaCarrito%}
                                    <tr>
                                        <td>
                                            <a href="#">
                                                <img src="/media/{{ item.idProducto.urlImagen }}" alt="White Blouse Armani">
                                            </a>
                                        </td>
                                        <td><a href="#">{{ item.idProducto.nombre }}</a>
                                        </td>
                                        <td>
                                            <input type="number" value="{{ item.cantidad }}" class="form-control">
                                        </td>
                                        <td>S/. {{item.idProducto.precioBasico}}</td>
                                        <td>{{ item.descuento }}</td>
                                        <td>{{ item.idProducto.precioBasico }}</td>
                                        <td><a href="#"><i class="fa fa-trash-o"></i></a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                <!-- /ITEM  -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th colspan="5">Total</th>
                                        <th colspan="2">$446.00</th>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>
                        <!-- /.table-responsive -->

                        <div class="box-footer">
                            <div class="pull-left">
                                <a href="\" class="btn btn-default"><i class="fa fa-chevron-left"></i> Continue shopping</a>
                            </div>
                            <div class="pull-right">
                                <a id="miBoton" class="btn btn-template-main" href="#" >Realizar el pago</a>
                            </div>               
                        </div>           
                        
                    </form>
                    <div class="panel panel-default" id="response-panel">
                        <div class="panel-body" id="response">La operación se realizó </div>
                    </div>

              
                    

                </div>
                <!-- /.box -->
             <!--   
                <div class="row">
                    <div class="col-md-3">
                        <div class="box text-uppercase">
                            <h3>Recomendaciones</h3>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="product">
                            <div class="image">
                                <a href="shop-detail.html">
                                    <img src="{% static 'img/product2.jpg' %}" alt="" class="img-responsive image1">
                                </a>
                            </div>
                            <div class="text">
                                <h3><a href="shop-detail.html">Fur coat</a></h3>
                                <p class="price">$143</p>

                            </div>
                        </div>                
                    </div>
                </div>
            -->



      
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
            <script src="https://checkout.culqi.com/plugins/v2"></script>
            <script type="text/javascript" src="{% static 'js/waitMe.min.js' %}"></script>
            <script>
            $("#response-panel").hide();
            Culqi.publicKey = 'pk_test_vzMuTHoueOMlgUPj';
            Culqi.settings({
                title: 'Culqi Store',
                currency: 'PEN',
                description: 'Polo/remera Culqi lover',
                amount: 3500
            });
            $('#miBoton').on('click', function (e) {
                // Abre el formulario con las opciones de Culqi.configurar
                Culqi.open();
                e.preventDefault();
            });
            // Recibimos Token del Culqi.js
            function culqi() {
              if (Culqi.token) {
                  $(document).ajaxStart(function(){
                    run_waitMe();
                  });
                  // Imprimir Token
                  $.ajax({
                     type: 'POST',
                     url: '/culqi/charges',
                     data: { csrfmiddlewaretoken: '{{ csrf_token }}', token: Culqi.token.id, installments: Culqi.token.metadata.installments },
                     datatype: 'json',
                     success: function(data){
                       var result = "";
                       if(data.constructor == String){
                           result = JSON.parse(data);
                       }
                       if(data.constructor == Object){
                           result = JSON.parse(JSON.stringify(data));
                       }
                       if(result.object === 'charge'){
                         resultdiv(result.outcome.user_message);
                       }
                       if(result.object === 'error'){
                           resultdiv(result.user_message);
                       }
                     },
                     error: function(error) {
                       resultdiv(error);
                     }
                  });
              } else {
                // Hubo un problema...
                // Mostramos JSON de objeto error en consola
                resultdiv(Culqi.error.user_message);
              }
            };
            function run_waitMe(){
              $('body').waitMe({
                effect: 'orbit',
                text: 'Procesando pago...',
                bg: 'rgba(255,255,255,0.7)',
                color:'#28d2c8'
              });
            }
            function resultdiv(message){
              $('#response-panel').show();
              $('#response').html(message);
              $('body').waitMe('hide');
            }
            </script>



            </div>

        </div>

    </div>
    <!-- /.container -->
</div>
<!-- /#content -->


{% endblock%}

